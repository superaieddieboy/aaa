<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>È†êÁ¥ÑÁ≥ªÁµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }

        .top-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .input-group {
            flex: 1;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .toolbar-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .button-row {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 40px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            background: #e0e0e0;
            color: #666;
        }

        .action-btn.active {
            background: #4a90e2;
            color: white;
        }

        .date-section {
            text-align: center;
            margin: 20px 0;
        }

        .date-display {
            display: inline-block;
            padding: 8px 20px;
            background: #f0f0f0;
            border-radius: 20px;
            cursor: pointer;
        }

        .color-picker {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin: 20px 0;
        }

        .color-box {
            width: 50px;
            height: 50px;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
        }

        .color-box.selected::after {
            content: "‚úì";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
        }

        .schedule-table th,
        .schedule-table td {
            border: 1px solid #ddd;
            padding: 10px;
        }

        .schedule-table th {
            background: #f8f8f8;
        }

        .schedule-cell {
            height: 60px;
            background: #e8e8e8;
            cursor: pointer;
            position: relative;
            vertical-align: top;
        }

        .booking {
            position: absolute;
            left: 2px;
            right: 2px;
            padding: 4px;
            font-size: 11px;
            border-radius: 3px;
            cursor: pointer;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .nav-btn {
            padding: 8px 20px;
            border: none;
            background: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        .search-section {
            margin: 30px 0;
            text-align: center;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            justify-content: center;
            max-width: 800px;
            margin: 0 auto;
        }

        .search-bar input {
            flex: 1;
            padding: 12px;
            border: 2px solid #4a90e2;
            border-radius: 25px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-btn {
            background: #e0e0e0;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
        }

        .service-item {
            padding: 15px;
            border: 1px solid #ddd;
            margin: 10px 0;
            border-radius: 4px;
            cursor: pointer;
        }

        .service-item.selected {
            background: #e3f2fd;
            border-color: #4a90e2;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        .btn-primary {
            background: #4a90e2;
            color: white;
        }

        .btn-secondary {
            background: #e0e0e0;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-section">
            <div class="input-group">
                <input type="text" id="customerName" placeholder="ÂèØ‰ª•Ëº∏ÂÖ•ÂÆ¢‰∫∫ÂêçÂ≠ó">
            </div>
            <div class="input-group">
                <input type="tel" id="customerPhone" placeholder="ÂÆ¢‰∫∫ÈõªË©±">
            </div>
        </div>

        <div class="toolbar">
            <button class="toolbar-btn">üìÖ</button>
            <button class="toolbar-btn">üïê</button>
            <button class="toolbar-btn">üìñ</button>
            <button class="toolbar-btn">üë•</button>
            <span style="margin-left: auto;">Yoda Master</span>
        </div>

        <div class="button-row">
            <button class="action-btn" id="bookBtn" onclick="toggleBooking()">È†êÁ¥Ñ</button>
            <button class="action-btn">Â¢ûÊ∑ª</button>
            <button class="action-btn" onclick="confirmSelection()">Á¢∫ÂÆö</button>
            <button class="action-btn">Âä†ÂÖ•Á≠âÂæÖÂêçÂñÆ</button>
            <button class="action-btn" onclick="openServiceManage()">Êñ∞Â¢ûÊúçÂãô</button>
        </div>

        <div class="date-section">
            <div class="date-display" onclick="openCalendar()">
                <span id="currentDate">2026Âπ¥2Êúà3Êó•</span>
            </div>
        </div>

        <div class="color-picker">
            <div class="color-box" style="background: #ff6b6b;" data-color="#ff6b6b"></div>
            <div class="color-box" style="background: #ffa500;" data-color="#ffa500"></div>
            <div class="color-box" style="background: #ffeb3b;" data-color="#ffeb3b"></div>
            <div class="color-box" style="background: #4caf50;" data-color="#4caf50"></div>
            <div class="color-box" style="background: #2196f3;" data-color="#2196f3"></div>
            <div class="color-box" style="background: #9c27b0;" data-color="#9c27b0"></div>
            <div class="color-box" style="background: #673ab7;" data-color="#673ab7"></div>
        </div>

        <table class="schedule-table">
            <thead>
                <tr>
                    <th>ÊôÇÈñì</th>
                    <th>erica</th>
                    <th>hold</th>
                    <th>ÂèñÊ∂àbooking</th>
                    <th>Monki</th>
                    <th>ÂÖ∂‰ªñ</th>
                    <th>ÂÖ∂‰ªñ</th>
                    <th>ÂÖ∂‰ªñ</th>
                    <th>ÂÖ∂‰ªñ</th>
                </tr>
            </thead>
            <tbody id="scheduleBody"></tbody>
        </table>

        <div class="navigation">
            <button class="nav-btn" onclick="changeDate(-1)">‰∏ä‰∏ÄÊó•</button>
            <button class="nav-btn" onclick="changeDate(0)">‰ªäÊó•</button>
            <button class="nav-btn" onclick="changeDate(1)">‰∏ã‰∏ÄÊó•</button>
        </div>

        <div class="search-section">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="ÊêúÁ¥¢ÂÆ¢‰∫∫ÂêçÂ≠óÊàñÈõªË©±">
                <button class="btn btn-primary" onclick="searchBookings()">ÊêúÂ∞ã</button>
            </div>
            <div id="searchResults"></div>
        </div>
    </div>

    <div class="modal" id="serviceModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('serviceModal')">√ó</button>
            <h3>ÈÅ∏ÊìáÊúçÂãô</h3>
            <div id="serviceList"></div>
            <button class="btn btn-primary" onclick="confirmService()">Á¢∫Ë™ç</button>
        </div>
    </div>

    <div class="modal" id="editModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('editModal')">√ó</button>
            <h3>Á∑®ËºØÈ†êÁ¥Ñ</h3>
            <input type="text" id="editName" placeholder="ÂÆ¢‰∫∫ÂêçÂ≠ó">
            <input type="tel" id="editPhone" placeholder="ÂÆ¢‰∫∫ÈõªË©±">
            <select id="editService"></select>
            <textarea id="editNote" placeholder="ÂÇôË®ª"></textarea>
            <input type="text" id="editMaster" placeholder="Master">
            <div>
                <button class="btn btn-primary" onclick="updateBooking()">Êõ¥Êñ∞</button>
                <button class="btn btn-secondary" onclick="changeTime()">ÊôÇÈñìÊõ¥Êîπ</button>
                <button class="btn btn-danger" onclick="cancelBooking()">ÂèñÊ∂àÈ†êÁ¥Ñ</button>
            </div>
        </div>
    </div>

    <div class="modal" id="serviceManageModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('serviceManageModal')">√ó</button>
            <h3>ÁÆ°ÁêÜÊúçÂãô</h3>
            <input type="text" id="newServiceName" placeholder="Êñ∞ÊúçÂãôÂêçÁ®±">
            <button class="btn btn-primary" onclick="addService()">Êñ∞Â¢û</button>
            <div id="serviceManageList"></div>
        </div>
    </div>

    <script>
        let currentDate = new Date(2026, 1, 3);
        let bookingMode = false;
        let selectedColor = null;
        let selectedCells = [];
        let bookings = [];
        let currentBookingId = null;
        let services = ["ÁúºÁ∑ö", "Áúâ", "Ë£úÁúºÁ∑ö", "Ë£úÁúâ", "ÈßêÈ°è", "ÁæéÁôΩ", "Â≠ïÁù´Ë°ì", "Ê∞¥Êô∂Âîá", "ËÑ´Áñ£", "È´ÆÈöõÁ∑ö"];

        const timeSlots = [
            "09:00 - 09:30", "09:30 - 10:00", "10:00 - 10:30", "10:30 - 11:00",
            "11:00 - 11:30", "11:30 - 12:00", "12:00 - 12:30", "12:30 - 13:00",
            "13:00 - 13:30", "13:30 - 14:00", "14:00 - 14:30", "14:30 - 15:00",
            "15:00 - 15:30", "15:30 - 16:00", "16:00 - 16:30", "16:30 - 17:00",
            "17:00 - 17:30", "17:30 - 18:00", "18:00 - 18:30", "18:30 - 19:00"
        ];

        function initSchedule() {
            const tbody = document.getElementById('scheduleBody');
            tbody.innerHTML = '';

            timeSlots.forEach((time, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${time}</td>`;

                for (let i = 1; i < 9; i++) {
                    const cell = document.createElement('td');
                    cell.className = 'schedule-cell';
                    cell.dataset.time = index;
                    cell.dataset.column = i;
                    cell.onclick = () => handleCellClick(index, i);
                    row.appendChild(cell);
                }

                tbody.appendChild(row);
            });
        }

        function toggleBooking() {
            bookingMode = !bookingMode;
            document.getElementById('bookBtn').classList.toggle('active');
            if (!bookingMode) {
                selectedCells = [];
                selectedColor = null;
                document.querySelectorAll('.color-box').forEach(box => box.classList.remove('selected'));
                document.querySelectorAll('.schedule-cell').forEach(cell => {
                    cell.style.background = '#e8e8e8';
                    cell.style.opacity = '1';
                });
            }
        }

        window.addEventListener('load', function() {
            document.querySelectorAll('.color-box').forEach(box => {
                box.onclick = function() {
                    document.querySelectorAll('.color-box').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedColor = this.dataset.color;
                };
            });

            initSchedule();
        });

        function handleCellClick(time, column) {
            const booking = bookings.find(b => 
                b.column === column && 
                time >= b.startTime && 
                time < b.endTime &&
                formatDate(b.date) === formatDate(currentDate)
            );

            if (booking) {
                openEditModal(booking);
                return;
            }

            if (bookingMode && selectedColor) {
                const index = selectedCells.findIndex(c => c.time === time && c.column === column);
                const cell = document.querySelector(`[data-time="${time}"][data-column="${column}"]`);

                if (index > -1) {
                    selectedCells.splice(index, 1);
                    cell.style.background = '#e8e8e8';
                    cell.style.opacity = '1';
                } else {
                    selectedCells.push({time, column});
                    cell.style.background = selectedColor;
                    cell.style.opacity = '0.5';
                }
            }
        }

        function confirmSelection() {
            if (!bookingMode) {
                alert('Ë´ãÂÖàÈªûÊìä„ÄåÈ†êÁ¥Ñ„ÄçÊåâÈàï');
                return;
            }

            if (selectedCells.length === 0) {
                alert('Ë´ãÂÖàÈÅ∏ÊìáÊôÇÊÆµ');
                return;
            }

            if (!selectedColor) {
                alert('Ë´ãÂÖàÈÅ∏ÊìáÈ°èËâ≤');
                return;
            }

            openServiceModal();
        }

        function openServiceModal() {
            const list = document.getElementById('serviceList');
            list.innerHTML = '';
            services.forEach(service => {
                const item = document.createElement('div');
                item.className = 'service-item';
                item.textContent = service;
                item.onclick = function() {
                    document.querySelectorAll('.service-item').forEach(s => s.classList.remove('selected'));
                    this.classList.add('selected');
                    this.dataset.selected = 'true';
                };
                list.appendChild(item);
            });
            document.getElementById('serviceModal').classList.add('show');
        }

        function confirmService() {
            const selected = document.querySelector('.service-item[data-selected="true"]');
            if (!selected) {
                alert('Ë´ãÈÅ∏ÊìáÊúçÂãô');
                return;
            }

            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;

            if (!name || !phone) {
                alert('Ë´ãËº∏ÂÖ•ÂÆ¢‰∫∫ÂêçÂ≠óÂíåÈõªË©±');
                return;
            }

            selectedCells.sort((a, b) => a.column !== b.column ? a.column - b.column : a.time - b.time);

            const groups = [];
            let currentGroup = [selectedCells[0]];

            for (let i = 1; i < selectedCells.length; i++) {
                const prev = selectedCells[i-1];
                const curr = selectedCells[i];

                if (curr.column === prev.column && curr.time === prev.time + 1) {
                    currentGroup.push(curr);
                } else {
                    groups.push(currentGroup);
                    currentGroup = [curr];
                }
            }
            groups.push(currentGroup);

            groups.forEach(group => {
                bookings.push({
                    id: Date.now() + Math.random(),
                    name: name,
                    phone: phone,
                    service: selected.textContent,
                    color: selectedColor,
                    startTime: group[0].time,
                    endTime: group[group.length - 1].time + 1,
                    column: group[0].column,
                    date: new Date(currentDate),
                    note: '',
                    createdAt: new Date()
                });
            });

            selectedCells = [];
            selectedColor = null;
            bookingMode = false;
            document.getElementById('bookBtn').classList.remove('active');
            document.querySelectorAll('.color-box').forEach(box => box.classList.remove('selected'));
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';

            document.querySelectorAll('.schedule-cell').forEach(cell => {
                cell.style.background = '#e8e8e8';
                cell.style.opacity = '1';
            });

            closeModal('serviceModal');
            renderBookings();
        }

        function renderBookings() {
            document.querySelectorAll('.booking').forEach(b => b.remove());

            const currentDateStr = formatDate(currentDate);
            const todayBookings = bookings.filter(b => formatDate(b.date) === currentDateStr);

            todayBookings.forEach(booking => {
                const cell = document.querySelector(`[data-time="${booking.startTime}"][data-column="${booking.column}"]`);

                if (cell) {
                    const div = document.createElement('div');
                    div.className = 'booking';
                    div.style.background = booking.color;
                    div.style.height = `calc(${(booking.endTime - booking.startTime) * 60}px - 4px)`;
                    div.innerHTML = `<div><strong>${booking.name}</strong></div><div>${booking.phone}</div><div>${booking.service}</div>`;
                    div.onclick = (e) => {
                        e.stopPropagation();
                        openEditModal(booking);
                    };
                    cell.appendChild(div);
                }
            });
        }

        function openEditModal(booking) {
            currentBookingId = booking.id;
            document.getElementById('editName').value = booking.name;
            document.getElementById('editPhone').value = booking.phone;
            document.getElementById('editNote').value = booking.note || '';
            document.getElementById('editMaster').value = booking.master || '';

            const select = document.getElementById('editService');
            select.innerHTML = '';
            services.forEach(service => {
                const option = document.createElement('option');
                option.value = service;
                option.textContent = service;
                if (service === booking.service) option.selected = true;
                select.appendChild(option);
            });

            document.getElementById('editModal').classList.add('show');
        }

        function updateBooking() {
            const booking = bookings.find(b => b.id === currentBookingId);
            if (booking) {
                booking.name = document.getElementById('editName').value;
                booking.phone = document.getElementById('editPhone').value;
                booking.service = document.getElementById('editService').value;
                booking.note = document.getElementById('editNote').value;
                booking.master = document.getElementById('editMaster').value;
                booking.updatedAt = new Date();
            }
            closeModal('editModal');
            renderBookings();
        }

        function changeTime() {
            const booking = bookings.find(b => b.id === currentBookingId);
            if (booking) {
                document.getElementById('customerName').value = booking.name;
                document.getElementById('customerPhone').value = booking.phone;

                document.querySelectorAll('.color-box').forEach(box => {
                    if (box.dataset.color === booking.color) {
                        box.classList.add('selected');
                        selectedColor = booking.color;
                    }
                });

                bookings = bookings.filter(b => b.id !== currentBookingId);
                bookingMode = true;
                document.getElementById('bookBtn').classList.add('active');

                closeModal('editModal');
                renderBookings();
            }
        }

        function cancelBooking() {
            if (confirm('Á¢∫ÂÆöË¶ÅÂèñÊ∂àÊ≠§È†êÁ¥ÑÂóéÔºü')) {
                bookings = bookings.filter(b => b.id !== currentBookingId);
                closeModal('editModal');
                renderBookings();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function formatDate(date) {
            return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
        }

        function changeDate(offset) {
            if (offset === 0) {
                currentDate = new Date(2026, 1, 3);
            } else {
                currentDate.setDate(currentDate.getDate() + offset);
            }
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            const day = currentDate.getDate();
            document.getElementById('currentDate').textContent = `${year}Âπ¥${month}Êúà${day}Êó•`;
            renderBookings();
        }

        function searchBookings() {
            const keyword = document.getElementById('searchInput').value.trim();
            if (!keyword) return;

            const results = bookings.filter(b => b.name.includes(keyword) || b.phone.includes(keyword));

            let html = '<table style="width:100%; margin-top:20px; border-collapse:collapse;">';
            html += '<tr><th style="border:1px solid #ddd; padding:10px;">ÂßìÂêç</th><th style="border:1px solid #ddd; padding:10px;">ÈõªË©±</th><th style="border:1px solid #ddd; padding:10px;">Êó•Êúü</th><th style="border:1px solid #ddd; padding:10px;">ÊúçÂãô</th></tr>';

            results.forEach(b => {
                html += `<tr><td style="border:1px solid #ddd; padding:10px;">${b.name}</td><td style="border:1px solid #ddd; padding:10px;">${b.phone}</td><td style="border:1px solid #ddd; padding:10px;">${formatDate(b.date)}</td><td style="border:1px solid #ddd; padding:10px;">${b.service}</td></tr>`;
            });

            html += '</table>';
            document.getElementById('searchResults').innerHTML = html;
        }

        function openServiceManage() {
            const list = document.getElementById('serviceManageList');
            list.innerHTML = '';
            services.forEach((service, index) => {
                const div = document.createElement('div');
                div.style.padding = '10px';
                div.style.border = '1px solid #ddd';
                div.style.margin = '5px 0';
                div.innerHTML = `${service} <button onclick="deleteService(${index})" class="btn btn-danger">Âà™Èô§</button>`;
                list.appendChild(div);
            });
            document.getElementById('serviceManageModal').classList.add('show');
        }

        function addService() {
            const name = document.getElementById('newServiceName').value.trim();
            if (name && !services.includes(name)) {
                services.push(name);
                document.getElementById('newServiceName').value = '';
                openServiceManage();
            }
        }

        function deleteService(index) {
            if (confirm('Á¢∫ÂÆöÂà™Èô§Ôºü')) {
                services.splice(index, 1);
                openServiceManage();
            }
        }

        function openCalendar() {
            alert('Êó•ÊõÜÂäüËÉΩÈñãÁôº‰∏≠');
        }
    </script>
</body>
</html>